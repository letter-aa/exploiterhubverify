var textbox = document.getElementById("discord");
var submitBtn = document.getElementById("submit-btn");
submitBtn.addEventListener("click", submit);
var numofhash = 0;
var numinclude = false;
var userlength = false;
var usernum = false;

function submit() {
    if (event.keyCode === 13) {
        event.preventDefault();
    }

    console.log("submit function called");
    for (var i = 0; i < textbox.value.length; i++) {
        if (textbox.value.charAt(i) === "#") {
            numofhash += 1;
        }
    }
    if (numofhash === 1) {
        if (textbox.value.lastIndexOf("#") + 5 === textbox.value.length || textbox.value.substring(textbox.value.lastIndexOf("#") + 1, textbox.value.length).length === 4) {
            if (!(isNaN(parseInt(textbox.value.substring(textbox.value.lastIndexOf("#") + 1, textbox.value.length))))) {
                usernum = true
            }
        }
    }

    if (textbox.value.substring(0, textbox.value.lastIndexOf("#")).length >= 2 && textbox.value.substring(0, textbox.value.lastIndexOf("#")).length <= 32) {
        userlength = true;
    }
    if (numofhash !== 1 || !(textbox.value.substring(textbox.value.lastIndexOf("#") + 1).length === 4 && !isNaN(parseInt(textbox.value.substring(textbox.value.lastIndexOf("#") + 1)))) || !userlength) {
        event.preventDefault()
        numofhash = 0
        usernum = false
        userlength = false
        textbox.value = "";
        const errorAnimation = [
            { transform: 'translate(0px, 0px) rotate(0deg)' },
            { transform: 'translate(-2px, -4px) rotate(-5deg)' },
            { transform: 'translate(4px, 2px) rotate(5deg)' },
            { transform: 'translate(-4px, -2px) rotate(-5deg)' },
            { transform: 'translate(2px, 4px) rotate(5deg)' },
            { transform: 'translate(-4px, 4px) rotate(-5deg)' },
            { transform: 'translate(4px, -2px) rotate(5deg)' },
            { transform: 'translate(-2px, 4px) rotate(-5deg)' },
            { transform: 'translate(2px, -4px) rotate(5deg)' },
            { transform: 'translate(0px, 0px) rotate(0deg)' },
        ];
        document.body.animate(errorAnimation, {
            duration: 550,
            iterations: 1,
        });
        document.querySelector('audio').play()
        return false;
    }
    if (numofhash === 1 && usernum === true && userlength === true) {
        return true;
    }
    return false;
}